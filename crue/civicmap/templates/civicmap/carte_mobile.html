{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>ğŸ„ MÃ©troSurf ğŸ„</title>
    <link rel="stylesheet" href="{% static 'civicmap/style.css' %}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>

    <div id="conteneur-carte">
        <div id="carte"></div>
        <div id="titre-mobile">ğŸ„ MÃ©troSurf ğŸ„<br>DÃ©couvrez lâ€™IsÃ¨re et le Drac comme vous ne les avez jamais vus !</div>
            <div id="legende-mobile">LÃ©gende :<br><span style="font-size: 15px;">ğŸ”µ</span> Station de mesures<br><span style="font-size: 30px;">ğŸ„</span> RepÃ¨re de crue</div>
    </div>
    
    
    <script>
        var fondDeCarte = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        });

        var carte = L.map('carte', {
            center: [45.19058736617489, 5.722605074139994],
            zoom: 13,
            layers: [fondDeCarte]
        });

        var vigIcon = L.divIcon({
            className: 'point',
            html: '<span style="font-size: 15px;">ğŸ”µ</span>', 
        });

        // Ajouter les stations de mesures sur la carte
        var stations = JSON.parse('{{stations|safe}}');
        stations.forEach(function(station) {
            L.marker([station.fields.latitude, station.fields.longitude], {icon: vigIcon}).addTo(carte)
                .bindPopup(`{% include "civiclapp/vigicrue.html" with data=data %}`,
                );
        });

        var emojiIcon = L.divIcon({
            className: 'point',
            html: '<span style="font-size: 30px;">ğŸ„</span>',
        });

        // Ajouter les repÃ¨res sur la carte
        var baseUrl = "{% url 'mobile' num='99999' %}".replace('99999', '').replace('//', '/');
        console.log(baseUrl);
        var reperes = JSON.parse('{{reperes|safe}}');
        reperes.forEach(function(repere) {
        var marker = L.marker([repere.fields.latitude, repere.fields.longitude], {icon: emojiIcon})
            .addTo(carte)
            .on('click', function() {
                window.location.href = baseUrl + repere.fields.id_gsheet;
            });
        });
    </script>
</body>
</html>
